<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Socio.io Backend Connection Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      color: #333;
    }
    h1 {
      color: #2c3e50;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
    }
    .container {
      background-color: #f9f9f9;
      border-radius: 5px;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .form-group {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"], textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
    }
    textarea {
      height: 100px;
      resize: vertical;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #2980b9;
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      border-radius: 4px;
      background-color: #f5f5f5;
      border-left: 4px solid #3498db;
    }
    .success {
      border-left-color: #2ecc71;
    }
    .error {
      border-left-color: #e74c3c;
    }
    pre {
      white-space: pre-wrap;
      word-break: break-word;
      background-color: #f8f9fa;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }
    .endpoints {
      margin-top: 30px;
    }
    .endpoint {
      margin-bottom: 20px;
      padding: 15px;
      background-color: #fff;
      border-radius: 4px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .endpoint h3 {
      margin-top: 0;
      color: #3498db;
    }
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 5px;
    }
    .status-online {
      background-color: #2ecc71;
    }
    .status-offline {
      background-color: #e74c3c;
    }
    .status-unknown {
      background-color: #f39c12;
    }
  </style>
</head>
<body>
  <h1>Socio.io Backend Connection Test</h1>
  
  <div class="container">
    <div class="form-group">
      <label for="backend-url">Backend URL:</label>
      <input type="text" id="backend-url" placeholder="https://your-backend-url.onrender.com">
    </div>
    
    <div class="form-group">
      <button id="test-connection">Test Connection</button>
      <button id="check-all-endpoints">Check All Endpoints</button>
    </div>
    
    <div id="connection-result" class="result" style="display: none;">
      <h3>Connection Status: <span id="connection-status">Unknown</span></h3>
      <div id="connection-details"></div>
    </div>
    
    <div class="endpoints">
      <h2>API Endpoints</h2>
      
      <div class="endpoint">
        <h3>Ping Endpoint</h3>
        <p>Tests basic connectivity to the backend server.</p>
        <p>Endpoint: <code>/ping</code></p>
        <p>Status: <span class="status-indicator status-unknown"></span> <span id="ping-status">Unknown</span></p>
        <button id="test-ping">Test Ping</button>
        <div id="ping-result" style="display: none;"></div>
      </div>
      
      <div class="endpoint">
        <h3>Status Endpoint</h3>
        <p>Checks the status of the backend services.</p>
        <p>Endpoint: <code>/api/status</code></p>
        <p>Status: <span class="status-indicator status-unknown"></span> <span id="status-endpoint-status">Unknown</span></p>
        <button id="test-status">Test Status</button>
        <div id="status-result" style="display: none;"></div>
      </div>
      
      <div class="endpoint">
        <h3>Text Analysis Endpoint</h3>
        <p>Tests the text content analysis functionality.</p>
        <p>Endpoint: <code>/analyze_text</code></p>
        <p>Status: <span class="status-indicator status-unknown"></span> <span id="text-status">Unknown</span></p>
        <div class="form-group">
          <label for="test-text">Text to analyze:</label>
          <textarea id="test-text">This is a test message to analyze content filtering.</textarea>
        </div>
        <button id="test-text-analysis">Test Text Analysis</button>
        <div id="text-result" style="display: none;"></div>
      </div>
      
      <div class="endpoint">
        <h3>Image Analysis Endpoint</h3>
        <p>Tests the image content analysis functionality.</p>
        <p>Endpoint: <code>/analyze_image</code></p>
        <p>Status: <span class="status-indicator status-unknown"></span> <span id="image-status">Unknown</span></p>
        <div class="form-group">
          <label for="image-url">Image URL to analyze:</label>
          <input type="text" id="image-url" value="https://cloud.google.com/vision/docs/images/bicycle_example.png">
        </div>
        <button id="test-image-analysis">Test Image Analysis</button>
        <div id="image-result" style="display: none;"></div>
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Get DOM elements
      const backendUrlInput = document.getElementById('backend-url');
      const testConnectionButton = document.getElementById('test-connection');
      const checkAllEndpointsButton = document.getElementById('check-all-endpoints');
      const connectionResult = document.getElementById('connection-result');
      const connectionStatus = document.getElementById('connection-status');
      const connectionDetails = document.getElementById('connection-details');
      
      const testPingButton = document.getElementById('test-ping');
      const testStatusButton = document.getElementById('test-status');
      const testTextAnalysisButton = document.getElementById('test-text-analysis');
      const testImageAnalysisButton = document.getElementById('test-image-analysis');
      
      const pingStatus = document.getElementById('ping-status');
      const statusEndpointStatus = document.getElementById('status-endpoint-status');
      const textStatus = document.getElementById('text-status');
      const imageStatus = document.getElementById('image-status');
      
      const pingResult = document.getElementById('ping-result');
      const statusResult = document.getElementById('status-result');
      const textResult = document.getElementById('text-result');
      const imageResult = document.getElementById('image-result');
      
      const testText = document.getElementById('test-text');
      const imageUrl = document.getElementById('image-url');
      
      // Load saved backend URL from localStorage
      const savedUrl = localStorage.getItem('backendUrl');
      if (savedUrl) {
        backendUrlInput.value = savedUrl;
      }
      
      // Test connection
      testConnectionButton.addEventListener('click', function() {
        const url = backendUrlInput.value.trim();
        if (!url) {
          alert('Please enter a backend URL first');
          return;
        }
        
        // Save URL to localStorage
        localStorage.setItem('backendUrl', url);
        
        connectionResult.style.display = 'block';
        connectionStatus.textContent = 'Testing...';
        connectionDetails.innerHTML = '';
        
        // Test ping endpoint
        fetch(`${url}/ping`)
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.text();
          })
          .then(data => {
            connectionStatus.textContent = 'Online';
            connectionResult.className = 'result success';
            connectionDetails.innerHTML = `
              <p>Successfully connected to the backend server!</p>
              <p>Response: ${data}</p>
              <p>You can now test individual endpoints below.</p>
            `;
            
            // Update ping status
            pingStatus.textContent = 'Online';
            document.querySelector('.endpoint:nth-child(1) .status-indicator').className = 'status-indicator status-online';
          })
          .catch(error => {
            connectionStatus.textContent = 'Offline';
            connectionResult.className = 'result error';
            connectionDetails.innerHTML = `
              <p>Failed to connect to the backend server.</p>
              <p>Error: ${error.message}</p>
              <p>Please check the URL and make sure the server is running.</p>
            `;
            
            // Update ping status
            pingStatus.textContent = 'Offline';
            document.querySelector('.endpoint:nth-child(1) .status-indicator').className = 'status-indicator status-offline';
          });
      });
      
      // Check all endpoints
      checkAllEndpointsButton.addEventListener('click', function() {
        testPingButton.click();
        setTimeout(() => testStatusButton.click(), 500);
        setTimeout(() => testTextAnalysisButton.click(), 1000);
        setTimeout(() => testImageAnalysisButton.click(), 1500);
      });
      
      // Test ping endpoint
      testPingButton.addEventListener('click', function() {
        const url = backendUrlInput.value.trim();
        if (!url) {
          alert('Please enter a backend URL first');
          return;
        }
        
        pingResult.style.display = 'block';
        pingResult.innerHTML = '<p>Testing...</p>';
        
        fetch(`${url}/ping`)
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.text();
          })
          .then(data => {
            pingStatus.textContent = 'Online';
            document.querySelector('.endpoint:nth-child(1) .status-indicator').className = 'status-indicator status-online';
            pingResult.innerHTML = `
              <p>Success!</p>
              <pre>${data}</pre>
            `;
            pingResult.className = 'result success';
          })
          .catch(error => {
            pingStatus.textContent = 'Offline';
            document.querySelector('.endpoint:nth-child(1) .status-indicator').className = 'status-indicator status-offline';
            pingResult.innerHTML = `
              <p>Error!</p>
              <pre>${error.message}</pre>
            `;
            pingResult.className = 'result error';
          });
      });
      
      // Test status endpoint
      testStatusButton.addEventListener('click', function() {
        const url = backendUrlInput.value.trim();
        if (!url) {
          alert('Please enter a backend URL first');
          return;
        }
        
        statusResult.style.display = 'block';
        statusResult.innerHTML = '<p>Testing...</p>';
        
        fetch(`${url}/api/status`)
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            statusEndpointStatus.textContent = 'Online';
            document.querySelector('.endpoint:nth-child(2) .status-indicator').className = 'status-indicator status-online';
            statusResult.innerHTML = `
              <p>Success!</p>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            statusResult.className = 'result success';
          })
          .catch(error => {
            statusEndpointStatus.textContent = 'Offline';
            document.querySelector('.endpoint:nth-child(2) .status-indicator').className = 'status-indicator status-offline';
            statusResult.innerHTML = `
              <p>Error!</p>
              <pre>${error.message}</pre>
            `;
            statusResult.className = 'result error';
          });
      });
      
      // Test text analysis endpoint
      testTextAnalysisButton.addEventListener('click', function() {
        const url = backendUrlInput.value.trim();
        const text = testText.value.trim();
        
        if (!url) {
          alert('Please enter a backend URL first');
          return;
        }
        
        if (!text) {
          alert('Please enter some text to analyze');
          return;
        }
        
        textResult.style.display = 'block';
        textResult.innerHTML = '<p>Analyzing...</p>';
        
        fetch(`${url}/analyze_text`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            text: text,
            url: 'https://example.com/test'
          })
        })
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            textStatus.textContent = 'Online';
            document.querySelector('.endpoint:nth-child(3) .status-indicator').className = 'status-indicator status-online';
            textResult.innerHTML = `
              <p>Success!</p>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            textResult.className = 'result success';
          })
          .catch(error => {
            textStatus.textContent = 'Offline';
            document.querySelector('.endpoint:nth-child(3) .status-indicator').className = 'status-indicator status-offline';
            textResult.innerHTML = `
              <p>Error!</p>
              <pre>${error.message}</pre>
            `;
            textResult.className = 'result error';
          });
      });
      
      // Test image analysis endpoint
      testImageAnalysisButton.addEventListener('click', function() {
        const url = backendUrlInput.value.trim();
        const imgUrl = imageUrl.value.trim();
        
        if (!url) {
          alert('Please enter a backend URL first');
          return;
        }
        
        if (!imgUrl) {
          alert('Please enter an image URL to analyze');
          return;
        }
        
        imageResult.style.display = 'block';
        imageResult.innerHTML = '<p>Analyzing...</p>';
        
        fetch(`${url}/analyze_image`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            image_url: imgUrl,
            url: 'https://example.com/test'
          })
        })
          .then(response => {
            if (!response.ok) {
              throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            imageStatus.textContent = 'Online';
            document.querySelector('.endpoint:nth-child(4) .status-indicator').className = 'status-indicator status-online';
            imageResult.innerHTML = `
              <p>Success!</p>
              <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
            imageResult.className = 'result success';
          })
          .catch(error => {
            imageStatus.textContent = 'Offline';
            document.querySelector('.endpoint:nth-child(4) .status-indicator').className = 'status-indicator status-offline';
            imageResult.innerHTML = `
              <p>Error!</p>
              <pre>${error.message}</pre>
            `;
            imageResult.className = 'result error';
          });
      });
    });
  </script>
</body>
</html>